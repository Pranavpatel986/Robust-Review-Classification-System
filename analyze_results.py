import pandas as pd
import matplotlib.pyplot as plt

def generate_insights():
    # 1. Load the results generated by main.py
    df = pd.read_csv("bodywash_test_final_optimized.csv")
    
    # 2. Convert comma-separated strings back into lists
    # Example: "Fragrance, Price" -> ["Fragrance", "Price"]
    df['Level 1 Factors'] = df['Level 1 Factors'].fillna("").apply(lambda x: [tag.strip() for tag in x.split(',') if tag])
    
    # 3. "Explode" the list so each tag gets its own row for counting
    exploded_df = df.explode('Level 1 Factors')
    
    # 4. Count the frequency of each taxonomy factor
    factor_counts = exploded_df['Level 1 Factors'].value_counts()
    
    # 5. Visualize the Volume of Insights
    plt.figure(figsize=(10, 6))
    factor_counts.plot(kind='barh', color='skyblue')
    plt.title('Consumer Insight Distribution (Gemini 2.5 Analysis)')
    plt.xlabel('Number of Mentions')
    plt.ylabel('Taxonomy Factor')
    plt.tight_layout()
    
    # Save the insight report
    plt.savefig("insight_distribution.png")
    print("Insight report generated: insight_distribution.png")
    
    # 6. Print a summary for the team
    print("\n--- TOP CONSUMER THEMES ---")
    print(factor_counts.head(5))

if __name__ == "__main__":
    generate_insights()